{
	ocsp_stapling off

	servers {
		trusted_proxies cloudflare {
			interval 1h
			timeout 15s
		}
	}
}

pass.cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	tls /data/cert_cy7.pem /data/key_cy7.pem

	encode zstd gzip

	# Proxy everything Rocket
	reverse_proxy vaultwarden:80 {
		header_up X-Real-IP {client_ip}
	}
}

dns.cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	encode zstd gzip
	tls /data/cert_cy7.pem /data/key_cy7.pem

	reverse_proxy adguard:80 {
		header_up X-Real-IP {client_ip}
	}
}

link.cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	tls /data/cert.pem /data/key.pem
	tls /data/cert_cy7.pem /data/key_cy7.pem
	encode zstd gzip

	reverse_proxy linkding:9090 {
		header_up X-Forwarded-For {client_ip}
	}
}

anki.cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	tls /data/cert.pem /data/key.pem
	tls /data/cert_cy7.pem /data/key_cy7.pem
	encode zstd gzip

	reverse_proxy anki-server:80 {
		header_up X-Real-IP {client_ip}
	}
}

git.cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	tls /data/cert_cy7.pem /data/key_cy7.pem
	encode zstd gzip

	reverse_proxy forgejo:3000 {
		header_up X-Real-IP {client_ip}
	}
}

rss.cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	tls /data/cert_cy7.pem /data/key_cy7.pem
	encode zstd gzip

	reverse_proxy miniflux:8080 {
		header_up X-Real-IP {client_ip}
	}
}

cy7.sh {
	log {
		level INFO
		output file {$LOG_FILE} {
			roll_size 10MB
			roll_keep 10
		}
	}
	tls /data/cert_cy7.pem /data/key_cy7.pem
	encode zstd gzip

	root /blogroot
	file_server

	# rss feed
	redir /rss /index.xml
	redir /feed /index.xml
}

www.cy7.sh {
	redir https://cy7.sh{uri} permanent
}
